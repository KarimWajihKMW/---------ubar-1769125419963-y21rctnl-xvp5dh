<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø§ÙƒØ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø§ÙƒØ¨</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø§ÙƒØ¨</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-600 mb-2">Ø§Ù„Ø§Ø³Ù…</label>
                    <input id="name" type="text" class="w-full px-4 py-2 border rounded-lg" value="Ø±Ø§ÙƒØ¨ ØªØ¬Ø±ÙŠØ¨ÙŠ">
                </div>
                
                <div>
                    <label class="block text-gray-600 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input id="phone" type="text" class="w-full px-4 py-2 border rounded-lg" value="0555456789">
                </div>
                
                <div>
                    <label class="block text-gray-600 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input id="email" type="email" class="w-full px-4 py-2 border rounded-lg" value="test@ubar.sa">
                </div>
                
                <div>
                    <label class="block text-gray-600 mb-2">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (0-5)</label>
                    <input id="rating" type="number" step="0.1" min="0" max="5" class="w-full px-4 py-2 border rounded-lg" value="4.5">
                </div>
                
                <div>
                    <label class="block text-gray-600 mb-2">Ù†Ù‚Ø§Ø· Ø£ÙƒÙˆØ§Ø¯Ø±Ø§</label>
                    <input id="points" type="number" class="w-full px-4 py-2 border rounded-lg" value="100">
                </div>
                
                <div>
                    <label class="block text-gray-600 mb-2">Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© (Ø±ÙŠØ§Ù„)</label>
                    <input id="balance" type="number" step="0.01" class="w-full px-4 py-2 border rounded-lg" value="250.75">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-gray-600 mb-2">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <select id="status" class="w-full px-4 py-2 border rounded-lg">
                        <option value="Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯">Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯</option>
                        <option value="ğŸ‘‘ Ø¹Ø¶Ùˆ Ø°Ù‡Ø¨ÙŠ" selected>ğŸ‘‘ Ø¹Ø¶Ùˆ Ø°Ù‡Ø¨ÙŠ</option>
                        <option value="ğŸ’ Ø¹Ø¶Ùˆ Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ">ğŸ’ Ø¹Ø¶Ùˆ Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ</option>
                        <option value="â­ Ø¹Ø¶Ùˆ VIP">â­ Ø¹Ø¶Ùˆ VIP</option>
                    </select>
                </div>
            </div>
            
            <div class="flex gap-4 mt-6">
                <button onclick="testLoginAndUpdate()" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                
                <button onclick="verifyData()" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 transition">
                    Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                </button>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
            <div id="results" class="space-y-2 font-mono text-sm"></div>
        </div>
    </div>

    <script src="api-service.js"></script>
    <script>
        let currentUserId = null;
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `p-2 rounded ${
                type === 'success' ? 'bg-green-100 text-green-800' :
                type === 'error' ? 'bg-red-100 text-red-800' :
                type === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                'bg-blue-100 text-blue-800'
            }`;
            div.textContent = message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        async function testLoginAndUpdate() {
            try {
                document.getElementById('results').innerHTML = '';
                
                log('ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...', 'info');
                
                // Step 1: Login/Register
                const phone = document.getElementById('phone').value;
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                
                log(`1ï¸âƒ£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${phone}`, 'info');
                
                const loginResponse = await ApiService.users.login(phone, name, email);
                
                if (!loginResponse.success) {
                    throw new Error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
                }
                
                currentUserId = loginResponse.data.id;
                log(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ (ID: ${currentUserId})`, 'success');
                
                // Step 2: Update passenger data
                log('2ï¸âƒ£ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø§ÙƒØ¨...', 'info');
                
                const updateData = {
                    name: name,
                    phone: phone,
                    email: email,
                    rating: parseFloat(document.getElementById('rating').value),
                    points: parseInt(document.getElementById('points').value),
                    balance: parseFloat(document.getElementById('balance').value),
                    status: document.getElementById('status').value
                };
                
                const updateResponse = await ApiService.passengers.update(currentUserId, updateData);
                
                if (!updateResponse.success) {
                    throw new Error('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
                log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                log(`   - Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${updateResponse.data.rating}`, 'info');
                log(`   - Ù†Ù‚Ø§Ø· Ø£ÙƒÙˆØ§Ø¯Ø±Ø§: ${updateResponse.data.points}`, 'info');
                log(`   - Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${updateResponse.data.balance} Ø±ÙŠØ§Ù„`, 'info');
                log(`   - Ø§Ù„Ø­Ø§Ù„Ø©: ${updateResponse.data.status}`, 'info');
                
                // Step 3: Verify immediately
                log('3ï¸âƒ£ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
                await verifyData();
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }
        
        async function verifyData() {
            try {
                if (!currentUserId) {
                    const phone = document.getElementById('phone').value;
                    log('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...', 'warning');
                    const loginResponse = await ApiService.users.login(phone);
                    currentUserId = loginResponse.data.id;
                }
                
                log(`ğŸ” Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ID: ${currentUserId})...`, 'info');
                
                const response = await ApiService.passengers.getById(currentUserId);
                
                if (!response.success) {
                    throw new Error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
                const data = response.data;
                
                log('âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', 'success');
                log(`   - Ø§Ù„Ø§Ø³Ù…: ${data.name}`, 'info');
                log(`   - Ø§Ù„Ù‡Ø§ØªÙ: ${data.phone}`, 'info');
                log(`   - Ø§Ù„Ø¨Ø±ÙŠØ¯: ${data.email}`, 'info');
                log(`   - Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${data.rating}`, 'info');
                log(`   - Ù†Ù‚Ø§Ø· Ø£ÙƒÙˆØ§Ø¯Ø±Ø§: ${data.points}`, 'info');
                log(`   - Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${data.balance} Ø±ÙŠØ§Ù„`, 'info');
                log(`   - Ø§Ù„Ø­Ø§Ù„Ø©: ${data.status}`, 'info');
                
                // Check if values match
                const expectedRating = parseFloat(document.getElementById('rating').value);
                const expectedPoints = parseInt(document.getElementById('points').value);
                const expectedBalance = parseFloat(document.getElementById('balance').value);
                const expectedStatus = document.getElementById('status').value;
                
                const ratingMatch = Math.abs(parseFloat(data.rating) - expectedRating) < 0.01;
                const pointsMatch = parseInt(data.points) === expectedPoints;
                const balanceMatch = Math.abs(parseFloat(data.balance) - expectedBalance) < 0.01;
                const statusMatch = data.status === expectedStatus;
                
                log('', 'info');
                log('ğŸ“Š Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ·Ø§Ø¨Ù‚:', 'info');
                log(ratingMatch ? 'âœ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù…ØªØ·Ø§Ø¨Ù‚' : 'âŒ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚', ratingMatch ? 'success' : 'error');
                log(pointsMatch ? 'âœ… Ù†Ù‚Ø§Ø· Ø£ÙƒÙˆØ§Ø¯Ø±Ø§ Ù…ØªØ·Ø§Ø¨Ù‚Ø©' : 'âŒ Ù†Ù‚Ø§Ø· Ø£ÙƒÙˆØ§Ø¯Ø±Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©', pointsMatch ? 'success' : 'error');
                log(balanceMatch ? 'âœ… Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…ØªØ·Ø§Ø¨Ù‚' : 'âŒ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚', balanceMatch ? 'success' : 'error');
                log(statusMatch ? 'âœ… Ø§Ù„Ø­Ø§Ù„Ø© Ù…ØªØ·Ø§Ø¨Ù‚Ø©' : 'âŒ Ø§Ù„Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©', statusMatch ? 'success' : 'error');
                
                if (ratingMatch && pointsMatch && balanceMatch && statusMatch) {
                    log('', 'info');
                    log('ğŸ‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¬Ø­! Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'success');
                } else {
                    log('', 'info');
                    log('âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªØªØ·Ø§Ø¨Ù‚', 'warning');
                }
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
