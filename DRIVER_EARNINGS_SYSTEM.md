# ูุธุงู ุฃุฑุจุงุญ ุงูุณุงุฆููู - Driver Earnings System

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุทููุฑ ูุธุงู ูุงูู ูุชุชุจุน ูุฅุฏุงุฑุฉ ุฃุฑุจุงุญ ุงูุณุงุฆููู ูู ุชุทุจูู ุฃููุงุฏุฑุง ุชุงูุณู.

## ุงูุชุญุฏูุซุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฃุนูุฏุฉ ุฌุฏูุฏุฉ ูู ุฌุฏูู `drivers`

```sql
ALTER TABLE drivers 
ADD COLUMN IF NOT EXISTS total_earnings NUMERIC(10,2) DEFAULT 0,
ADD COLUMN IF NOT EXISTS balance NUMERIC(10,2) DEFAULT 0,
ADD COLUMN IF NOT EXISTS today_earnings NUMERIC(10,2) DEFAULT 0,
ADD COLUMN IF NOT EXISTS today_trips_count INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS last_earnings_reset TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
```

### ุงูุฃุนูุฏุฉ ุงููุถุงูุฉ:
- **total_earnings**: ุฅุฌูุงูู ุงูุฃุฑุจุงุญ ููุฐ ุจุฏุก ุงูุนูู
- **balance**: ุงูุฑุตูุฏ ุงููุชุงุญ ููุณุญุจ
- **today_earnings**: ุฃุฑุจุงุญ ุงูููู ุงูุญุงูู
- **today_trips_count**: ุนุฏุฏ ุฑุญูุงุช ุงูููู
- **last_earnings_reset**: ุขุฎุฑ ุชุงุฑูุฎ ูุฅุนุงุฏุฉ ุชุนููู ุฃุฑุจุงุญ ุงูููู

## API Endpoints ุงูุฌุฏูุฏุฉ

### 1. ุงูุญุตูู ุนูู ุฅุญุตุงุฆูุงุช ุงูุณุงุฆู
```
GET /api/drivers/:id/stats
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
  "success": true,
  "data": {
    "driver": {
      "id": 2,
      "name": "ูุญูุฏ ุนูู ุงูุดูุฑู",
      "phone": "0507654321",
      "email": "driver2@ubar.sa",
      "rating": 4.92
    },
    "earnings": {
      "total": 125.50,
      "balance": 125.50,
      "today": 75.50
    },
    "trips": {
      "total": 588,
      "today": 9,
      "completed": 24
    },
    "recent_trips": [...]
  }
}
```

## ุงูุชุญุฏูุซุงุช ุงูุชููุงุฆูุฉ

### ุชุญุฏูุซ ุงูุฃุฑุจุงุญ ุนูุฏ ุฅููุงู ุงูุฑุญูุฉ
ุนูุฏ ุงุณุชุฏุนุงุก `PATCH /api/trips/:id/status` ูุน `status: 'completed'`ุ ูุชู ุชููุงุฆูุงู:

1. ุฅุถุงูุฉ ุชูููุฉ ุงูุฑุญูุฉ ุฅูู `total_earnings`
2. ุฅุถุงูุฉ ุชูููุฉ ุงูุฑุญูุฉ ุฅูู `balance`
3. ุฅุถุงูุฉ ุชูููุฉ ุงูุฑุญูุฉ ุฅูู `today_earnings`
4. ุฒูุงุฏุฉ `today_trips_count` ุจููุฏุงุฑ 1
5. ุฒูุงุฏุฉ `total_trips` ุจููุฏุงุฑ 1

**ูุซุงู:**
```javascript
// ุฅููุงู ุฑุญูุฉ ุจุชูููุฉ 75.50 SAR
PATCH /api/trips/TR-1770576331846/status
{
  "status": "completed",
  "cost": 75.50
}

// ุณูุชู ุชููุงุฆูุงู ุชุญุฏูุซ ุฃุฑุจุงุญ ุงูุณุงุฆู ูู ุฌุฏูู drivers
```

## ุชุญุฏูุซุงุช ุงููุงุฌูุฉ

### ุตูุญุฉ ุงูุฃุฑุจุงุญ (earnings.html)

ุชู ุชุญุฏูุซ ุงูุตูุญุฉ ูุชุญููู ุงูุจูุงูุงุช ุงูุญููููุฉ ูู API ุจุฏูุงู ูู ุงูุจูุงูุงุช ุงูุซุงุจุชุฉ:

**ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ:**
- โ ุนุฑุถ ุงูุฑุตูุฏ ุงูุญูููู ููุณุงุฆู
- โ ุนุฑุถ ุฅุฌูุงูู ุงูุฑุญูุงุช ุงูููุชููุฉ
- โ ุนุฑุถ ุฑุญูุงุช ุงูููู
- โ ุนุฑุถ ุฃุฑุจุงุญ ุงูููู
- โ ุนุฑุถ ุขุฎุฑ 10 ุฑุญูุงุช ูุน ุงูุชูุงุตูู
- โ ุชูุณูู ุงูุชุงุฑูุฎ ูุงูููุช ุจุดูู ุฏููุงูููู
- โ ุฏุนู ุงููุถุน ุงููููู

**ููููุฉ ุงูุงุณุชุฎุฏุงู:**
```javascript
// ูุชู ุชุญููู ุจูุงูุงุช ุงูุณุงุฆู ุชููุงุฆูุงู ูู localStorage
const driverProfile = JSON.parse(localStorage.getItem('akwadra_driver_profile'));
const driverId = driverProfile.id;

// ุซู ูุชู ุฌูุจ ุงูุจูุงูุงุช ูู API
fetch(`/api/drivers/${driverId}/stats`)
```

## ุงูุงุฎุชุจุงุฑุงุช

### ููู ุงูุงุฎุชุจุงุฑ: `test-driver-earnings.js`

**ุชุดุบูู ุงูุงุฎุชุจุงุฑ:**
```bash
node test-driver-earnings.js
```

**ูุง ูุชู ุงุฎุชุจุงุฑู:**
1. โ ุงูุญุตูู ุนูู ุฅุญุตุงุฆูุงุช ุงูุณุงุฆู
2. โ ุฅูุดุงุก ุฑุญูุฉ ุฌุฏูุฏุฉ
3. โ ุฅููุงู ุงูุฑุญูุฉ
4. โ ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุฃุฑุจุงุญ ุชููุงุฆูุงู

**ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ ุงููุงุฌุญ:**
```
๐งช ุงุฎุชุจุงุฑ ูุธุงู ุฃุฑุจุงุญ ุงูุณุงุฆููู

1๏ธโฃ ุงุฎุชุจุงุฑ ุงูุญุตูู ุนูู ุฅุญุตุงุฆูุงุช ุงูุณุงุฆู...
โ ูุฌุญ ุงูุญุตูู ุนูู ุงูุฅุญุตุงุฆูุงุช
   ุงูุฑุตูุฏ: 50 SAR
   ุฃุฑุจุงุญ ุงูููู: 50 SAR
   ุฅุฌูุงูู ุงูุฃุฑุจุงุญ: 50 SAR

2๏ธโฃ ุฅูุดุงุก ุฑุญูุฉ ุงุฎุชุจุงุฑูุฉ...
โ ุชู ุฅูุดุงุก ุฑุญูุฉ ุฌุฏูุฏุฉ

3๏ธโฃ ุฅููุงู ุงูุฑุญูุฉ...
โ ุชู ุฅููุงู ุงูุฑุญูุฉ ุจูุฌุงุญ

4๏ธโฃ ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช...
โ ุชู ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
   ุงูุฑุตูุฏ ุงูุณุงุจู: 50 SAR
   ุงูุฑุตูุฏ ุงูุฌุฏูุฏ: 125.5 SAR
   ุงููุฑู: +75.50 SAR

โ โ โ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช! โ โ โ
```

## ุงููููุงุช ุงููุนุฏูุฉ

1. **server.js** - ุฅุถุงูุฉ API endpoints ูุชุญุฏูุซ ููุทู ุงูุฑุญูุงุช
2. **earnings.html** - ุชุญุฏูุซ ุงููุงุฌูุฉ ูุชุญููู ุงูุจูุงูุงุช ุงูุญููููุฉ
3. **test-driver-earnings.js** - ููู ุงุฎุชุจุงุฑ ุดุงูู (ุฌุฏูุฏ)

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```
postgresql://postgres:gnQuusUxfjjvwiryBRkdvFjzBkXhEieJ@trolley.proxy.rlwy.net:47888/railway
```

## ุงููุชุทูุจุงุช ุงููุณุชูุจููุฉ

### ูุญุชููุฉ ููุชุทููุฑ:
- [ ] ุฅุถุงูุฉ ูุธุงู ูุฅุนุงุฏุฉ ุชุนููู ุฃุฑุจุงุญ ุงูููู ุชููุงุฆูุงู ูู ููุชุตู ุงูููู
- [ ] ุฅุถุงูุฉ ุชูุงุฑูุฑ ุฃุณุจูุนูุฉ ูุดูุฑูุฉ
- [ ] ุฅุถุงูุฉ ูุธุงู ุณุญุจ ุงูุฃุฑุจุงุญ
- [ ] ุฅุถุงูุฉ ุณุฌู ุงููุนุงููุงุช ุงููุงููุฉ
- [ ] ุฅุถุงูุฉ ูุธุงู ุงูููุงูุขุช ูุงูุญูุงูุฒ
- [ ] ุฅุถุงูุฉ ุฎุตููุงุช ูุฑุณูู ุงูุดุฑูุฉ

## ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ูู ุญุงูุฉ ูุฌูุฏ ุฃู ูุดุงููุ ูููู ุงูุชุญูู ูู:
- ุงูุณุฌูุงุช ูู ูุญุฏุฉ ุงูุชุญูู
- ุญุงูุฉ ุงูุฎุงุฏู: `GET /api/health`
- ุจูุงูุงุช ุงูุณุงุฆู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ
- **ุงูุฅุตุฏุงุฑ:** 1.0.0
- **ุงูุชุงุฑูุฎ:** 8 ูุจุฑุงูุฑ 2026
- **ุงููุทูุฑ:** ุฃููุงุฏุฑุง ุชุงูุณู
