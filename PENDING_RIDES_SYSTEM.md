# ูุธุงู ุทูุจุงุช ุงูุฑุญูุงุช ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
## Pending Ride Requests System

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุฑุญูุงุช ุงูุชู ุชูุชุธุฑ ููุงููุฉ ุงูุณุงุฆููู ูู ุชุทุจูู ุฃูุจุฑ.

## ููููุงุช ุงููุธุงู

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช

ุชู ุฅูุดุงุก ุฌุฏูู `pending_ride_requests` ุจุงูุฃุนูุฏุฉ ุงูุชุงููุฉ:

```sql
CREATE TABLE pending_ride_requests (
    id SERIAL PRIMARY KEY,
    request_id VARCHAR(50) UNIQUE NOT NULL,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    passenger_name VARCHAR(100),
    passenger_phone VARCHAR(20),
    pickup_location VARCHAR(255) NOT NULL,
    dropoff_location VARCHAR(255) NOT NULL,
    pickup_lat DECIMAL(10, 8),
    pickup_lng DECIMAL(11, 8),
    dropoff_lat DECIMAL(10, 8),
    dropoff_lng DECIMAL(11, 8),
    car_type VARCHAR(50) DEFAULT 'economy',
    estimated_cost DECIMAL(10, 2),
    estimated_distance DECIMAL(10, 2),
    estimated_duration INTEGER,
    payment_method VARCHAR(20) DEFAULT 'cash',
    status VARCHAR(20) DEFAULT 'waiting',
    assigned_driver_id INTEGER REFERENCES drivers(id) ON DELETE SET NULL,
    assigned_at TIMESTAMP,
    rejected_by INTEGER[] DEFAULT ARRAY[]::INTEGER[],
    rejection_count INTEGER DEFAULT 0,
    expires_at TIMESTAMP,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### ุญุงูุงุช ุงูุทูุจ (Status)
- `waiting`: ูู ุงูุชุธุงุฑ ููุงููุฉ ุณุงุฆู
- `accepted`: ุชู ูุจูู ุงูุทูุจ ูู ุณุงุฆู
- `rejected`: ุชู ุฑูุถ ุงูุทูุจ ูู ุฌููุน ุงูุณุงุฆููู
- `cancelled`: ุชู ุฅูุบุงุก ุงูุทูุจ ูู ุงูุฑุงูุจ
- `expired`: ุงูุชูุช ุตูุงุญูุฉ ุงูุทูุจ (ุจุนุฏ 20 ุฏูููุฉ)

### 2. API Endpoints

#### ุฅูุดุงุก ุทูุจ ุฑุญูุฉ ุฌุฏูุฏ
```http
POST /api/pending-rides
Content-Type: application/json

{
    "user_id": 1,
    "passenger_name": "ุฃุญูุฏ ูุญูุฏ",
    "passenger_phone": "0551234567",
    "pickup_location": "ูุทุงุฑ ุงูููู ุฎุงูุฏ ุงูุฏููู",
    "dropoff_location": "ุจุฑุฌ ุงูููููุฉุ ุงูุฑูุงุถ",
    "pickup_lat": 24.9576,
    "pickup_lng": 46.6988,
    "dropoff_lat": 24.7110,
    "dropoff_lng": 46.6750,
    "car_type": "economy",
    "estimated_cost": 95.50,
    "estimated_distance": 35.2,
    "estimated_duration": 45,
    "payment_method": "cash",
    "notes": "ูู ูุถูู ูู ูู ุงูููุนุฏ"
}
```

#### ุงูุญุตูู ุนูู ุฌููุน ุงูุทูุจุงุช
```http
GET /api/pending-rides?status=waiting&car_type=economy&limit=10
```

#### ุงูุญุตูู ุนูู ุทูุจ ูุญุฏุฏ
```http
GET /api/pending-rides/:request_id
```

#### ุงูุญุตูู ุนูู ุทูุจุงุช ุณุงุฆู ูุญุฏุฏ
```http
GET /api/drivers/:driver_id/pending-rides
```
ูุนุฑุถ ุงูุทูุจุงุช ุงูุชู:
- ุญุงูุชูุง `waiting`
- ููุน ุงูุณูุงุฑุฉ ูุทุงุจู ุณูุงุฑุฉ ุงูุณุงุฆู
- ูู ูุฑูุถูุง ูุฐุง ุงูุณุงุฆู ูู ูุจู
- ูู ุชูุชู ุตูุงุญูุชูุง

#### ูุจูู ุทูุจ ุฑุญูุฉ (ุงูุณุงุฆู)
```http
POST /api/pending-rides/:request_id/accept
Content-Type: application/json

{
    "driver_id": 1
}
```

#### ุฑูุถ ุทูุจ ุฑุญูุฉ (ุงูุณุงุฆู)
```http
POST /api/pending-rides/:request_id/reject
Content-Type: application/json

{
    "driver_id": 2
}
```
- ูุชู ุฅุถุงูุฉ ุงูุณุงุฆู ููุงุฆูุฉ `rejected_by`
- ูุชู ุฒูุงุฏุฉ `rejection_count`
- ุงูุทูุจ ูุจูู `waiting` ููุนุฑุถ ูุณุงุฆููู ุขุฎุฑูู

#### ุฅูุบุงุก ุทูุจ (ุงูุฑุงูุจ)
```http
POST /api/pending-rides/:request_id/cancel
```

#### ุชูุธูู ุงูุทูุจุงุช ุงูููุชููุฉ
```http
POST /api/pending-rides/cleanup
```
ูุญูู ุฌููุน ุงูุทูุจุงุช ุงูุชู ุงูุชูุช ุตูุงุญูุชูุง ูู `waiting` ุฅูู `expired`

### 3. ุงููุงุฌูุฉ

ุชู ุฅูุดุงุก ุตูุญุฉ `pending-rides.html` ุชุนุฑุถ:
- **ุฅุญุตุงุฆูุงุช ูุจุงุดุฑุฉ**: ุนุฏุฏ ุงูุทูุจุงุช ูู ุงูุงูุชุธุงุฑุ ุงูููุจููุฉุ ุงููุฑููุถุฉุ ูุงูุฅุฌูุงูู
- **ููุชุฑุฉ**: ุญุณุจ ุงูุญุงูุฉ ูููุน ุงูุณูุงุฑุฉ
- **ุจุทุงูุงุช ููุตูุฉ** ููู ุทูุจ ุชุญุชูู ุนูู:
  - ูุนูููุงุช ุงูุฑุงูุจ
  - ูููุน ุงูุงูุทูุงู ูุงููุตูู
  - ุงูุณุนุฑ ุงููุชููุน ูุงููุณุงูุฉ
  - ููุน ุงูุณูุงุฑุฉ
  - ุนุฏุฏ ูุฑุงุช ุงูุฑูุถ
  - ูุนูููุงุช ุงูุณุงุฆู ุงููุนูู (ุฅู ูุฌุฏ)
  - ููุช ุงูุฅูุดุงุก ูููุช ุงูุชูุงุก ุงูุตูุงุญูุฉ
- **ุชุญุฏูุซ ุชููุงุฆู** ูู 30 ุซุงููุฉ
- **ุฒุฑ ุชูุธูู** ููุทูุจุงุช ุงูููุชููุฉ

### 4. ุงููููุงุช ุงููุถุงูุฉ

- `create-pending-rides-table.js`: ุณูุฑูุจุช ุฅูุดุงุก ุงูุฌุฏูู ูุฅุฏุฎุงู ุจูุงูุงุช ุชุฌุฑูุจูุฉ
- `test-pending-rides.js`: ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ูุฌููุน API endpoints
- `pending-rides.html`: ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุทูุจุงุช
- `PENDING_RIDES_SYSTEM.md`: ูุฐุง ุงูููู

### 5. ุงูุชุญุฏูุซุงุช ุนูู ุงููููุงุช ุงูููุฌูุฏุฉ

#### server.js
ุฃุถููุช ุฌููุน API endpoints ููุทูุจุงุช ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุจู ุจุฏุก ุงูุณูุฑูุฑ.

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุฅูุดุงุก ุงูุฌุฏูู
```bash
DATABASE_URL="your_database_url" node create-pending-rides-table.js
```

### ุงุฎุชุจุงุฑ ุงููุธุงู
```bash
# ุชุฃูุฏ ูู ุชุดุบูู ุงูุณูุฑูุฑ ุฃููุงู
DATABASE_URL="your_database_url" npm start

# ูู terminal ุขุฎุฑ
node test-pending-rides.js
```

### ุนุฑุถ ุงููุงุฌูุฉ
ุงูุชุญ `http://localhost:3000/pending-rides.html` ูู ุงููุชุตูุญ

## ููุฒุงุช ุงููุธุงู

โ **ุชุชุจุน ูุงูู ููุทูุจุงุช**: ูู ุงูุฅูุดุงุก ุญุชู ุงููุจูู/ุงูุฑูุถ/ุงูุฅูุบุงุก  
โ **ููุน ุงูุชูุฑุงุฑ**: ุงูุณุงุฆููู ุงูุฐูู ุฑูุถูุง ูุง ูุฑูู ุงูุทูุจ ูุฑุฉ ุฃุฎุฑู  
โ **ุงูุชูุงุก ุงูุตูุงุญูุฉ ุงูุชููุงุฆู**: ุงูุทูุจุงุช ุชูุชูู ุจุนุฏ 20 ุฏูููุฉ  
โ **ุชุตููู ุญุณุจ ููุน ุงูุณูุงุฑุฉ**: ูู ุณุงุฆู ูุฑู ุงูุทูุจุงุช ุงูููุงุณุจุฉ ูููุน ุณูุงุฑุชู  
โ **ูุงุฌูุฉ ุนุตุฑูุฉ**: ุชุตููู ุฌููู ูุณูู ุงูุงุณุชุฎุฏุงู  
โ **ุชุญุฏูุซุงุช ูุจุงุดุฑุฉ**: ุชุญุฏูุซ ุชููุงุฆู ููุจูุงูุงุช  
โ **ุงุฎุชุจุงุฑุงุช ุดุงููุฉ**: ุชุบุทูุฉ ูุงููุฉ ูุฌููุน ุงูุณููุงุฑูููุงุช  

## ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ุณููุงุฑูู 1: ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
1. ุฑุงูุจ ูุทูุจ ุฑุญูุฉ
2. ูุชู ุฅูุดุงุก ุณุฌู ูู `pending_ride_requests` ุจุญุงูุฉ `waiting`
3. ูุชู ุชุนููู ููุช ุงูุชูุงุก ุตูุงุญูุฉ (20 ุฏูููุฉ)

### ุณููุงุฑูู 2: ุนุฑุถ ููุณุงุฆู
1. ุณุงุฆู ููุชุญ ุงูุชุทุจูู
2. ูุฑู ุงูุทูุจุงุช ุงููุทุงุจูุฉ ูููุน ุณูุงุฑุชู
3. ูุง ูุฑู ุงูุทูุจุงุช ุงูุชู ุฑูุถูุง ุณุงุจูุงู

### ุณููุงุฑูู 3: ูุจูู ุงูุณุงุฆู
1. ุณุงุฆู ููุจู ุงูุทูุจ
2. ูุชู ุชุญุฏูุซ `status` ุฅูู `accepted`
3. ูุชู ุฑุจุท `assigned_driver_id` ุจุงูุณุงุฆู
4. ูุชู ุชุณุฌูู `assigned_at`

### ุณููุงุฑูู 4: ุฑูุถ ุงูุณุงุฆู
1. ุณุงุฆู ูุฑูุถ ุงูุทูุจ
2. ูุชู ุฅุถุงูุฉ ID ุงูุณุงุฆู ุฅูู `rejected_by`
3. ูุชู ุฒูุงุฏุฉ `rejection_count`
4. ุงูุทูุจ ูุจูู ูุชุงุญุงู ูุณุงุฆููู ุขุฎุฑูู

### ุณููุงุฑูู 5: ุงูุชูุงุก ุงูุตูุงุญูุฉ
1. ุชูุฑ 20 ุฏูููุฉ ุจุฏูู ูุจูู
2. ุนูุฏ ุงุณุชุฏุนุงุก `/cleanup`ุ ูุชู ุชุญุฏูุซ `status` ุฅูู `expired`

## ุงูุงุฎุชุจุงุฑุงุช ุงููููุฐุฉ

ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช ุจูุฌุงุญ โ:

1. โ ุฅูุดุงุก ุทูุจ ุฑุญูุฉ ุฌุฏูุฏ
2. โ ุงูุญุตูู ุนูู ุฌููุน ุงูุทูุจุงุช
3. โ ููุชุฑุฉ ุงูุทูุจุงุช ุญุณุจ ุงูุญุงูุฉ
4. โ ุงูุญุตูู ุนูู ุทูุจ ูุญุฏุฏ
5. โ ุงูุญุตูู ุนูู ุทูุจุงุช ุณุงุฆู ูุญุฏุฏ
6. โ ุฑูุถ ุทูุจ ูู ุณุงุฆู
7. โ ูุจูู ุทูุจ ูู ุณุงุฆู
8. โ ุฅูุบุงุก ุทูุจ
9. โ ุชูุธูู ุงูุทูุจุงุช ุงูููุชููุฉ
10. โ ุนุฑุถ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

## ุชุญุณููุงุช ูุณุชูุจููุฉ ูุญุชููุฉ

- [ ] ุฅุดุนุงุฑุงุช ููุฑูุฉ ููุณุงุฆููู ุนูุฏ ุทูุจ ุฌุฏูุฏ (WebSocket/Notifications)
- [ ] ุฎูุงุฑุฒููุฉ ุฐููุฉ ูุชูุฒูุน ุงูุทูุจุงุช ุนูู ุฃูุฑุจ ุงูุณุงุฆููู
- [ ] ูุธุงู ุฃููููุงุช ููุฑุงูุจูู ุงููุฎูุตูู
- [ ] ุชูุงุฑูุฑ ูุฅุญุตุงุฆูุงุช ุนู ูุนุฏูุงุช ุงููุจูู/ุงูุฑูุถ
- [ ] API ูุชุนุฏูู ููุช ุงูุชูุงุก ุงูุตูุงุญูุฉ
- [ ] ูุธุงู ุฅุนุงุฏุฉ ูุญุงููุฉ ุชููุงุฆู ููุทูุจุงุช ุงููุฑููุถุฉ ูุซูุฑุงู

## ุงูุฎูุงุตุฉ

ุชู ุจูุงุก ูุธุงู ูุชูุงูู ูููู ูุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุฑุญูุงุช ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุน:
- ูุงุนุฏุฉ ุจูุงูุงุช ูุญุณููุฉ
- API endpoints ุดุงููุฉ
- ูุงุฌูุฉ ูุณุชุฎุฏู ุนุตุฑูุฉ
- ุงุฎุชุจุงุฑุงุช ูุงููุฉ
- ุชูุซูู ุดุงูู

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู! ๐
