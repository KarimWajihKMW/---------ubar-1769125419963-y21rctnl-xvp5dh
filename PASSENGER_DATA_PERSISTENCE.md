# ุชุญุฏูุซ ูุธุงู ุญูุธ ุจูุงูุงุช ุงูุฑูุงุจ
> **ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 5 ูุจุฑุงูุฑ 2026

## ๐ ุงูููุฎุต

ุชู ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุญูุธ ุจูุงูุงุช ุงูุฑุงูุจ (ุงูุชููููุ ููุงุท ุฃููุงุฏุฑุงุ ุฑุตูุฏ ุงููุญูุธุฉุ ุงูุญุงูุฉุ ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ) ุจุดูู ุฏุงุฆู ุนูุฏ ุงูุชุนุฏูู ูู ุตูุญุฉ ุงูููู ุงูุดุฎุตู. ุงูุขู ุฌููุน ุงูุชุนุฏููุงุช ุชูุญูุธ ุชููุงุฆูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุง ุชุฎุชูู ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ุฃู ุฅุบูุงู ุงูุตูุญุฉ.

## โ ุงููุดุงูู ุงูุชู ุชู ุญููุง

### ุงููุดููุฉ ุงูุฃุณุงุณูุฉ
- **ูุจู ุงูุฅุตูุงุญ:** ุนูุฏ ุชุนุฏูู ุจูุงูุงุช ุงูุฑุงูุจ (ุงูุชููููุ ููุงุท ุฃููุงุฏุฑุงุ ุฑุตูุฏ ุงููุญูุธุฉุ ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ)ุ ูุงูุช ุงูุชุนุฏููุงุช ุชุฎุชูู ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ุฃู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ.
- **ุจุนุฏ ุงูุฅุตูุงุญ:** ุฌููุน ุงูุชุนุฏููุงุช ุชูุญูุธ ููุฑุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุจูู ุจุดูู ุฏุงุฆู.

### ุงูุจูุงูุงุช ุงููุชุฃุซุฑุฉ
1. โญ **ุงูุชูููู** (rating)
2. ๐ฏ **ููุงุท ุฃููุงุฏุฑุง** (points)
3. ๐ฐ **ุฑุตูุฏ ุงููุญูุธุฉ** (balance)
4. ๐ **ุงูุญุงูุฉ** (status)
5. ๐ผ๏ธ **ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ** (avatar)
6. ๐ **ููุน ุงูุณูุงุฑุฉ** (car_type)
7. ๐ข **ุฑูู ุงูููุญุฉ** (car_plate)

## ๐ง ุงูุชุนุฏููุงุช ุงูุชูููุฉ

### 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# ุชุดุบูู migration ูุฅุถุงูุฉ ุงูุญููู ุงููุทููุจุฉ
node migrate-users-table.js
```

ุชู ุฅุถุงูุฉ ุงูุญููู ุงูุชุงููุฉ ูุฌุฏูู `users`:
- `car_type` - ููุน ุงูุณูุงุฑุฉ
- `car_plate` - ุฑูู ุงูููุญุฉ
- `balance` - ุฑุตูุฏ ุงููุญูุธุฉ (decimal)
- `points` - ููุงุท ุฃููุงุฏุฑุง (integer)
- `rating` - ุงูุชูููู (decimal)
- `status` - ุงูุญุงูุฉ (varchar)
- `avatar` - ุฑุงุจุท ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ (text)

### 2. ุชุญุฏูุซ API Endpoints

#### ุชุญุฏูุซ `/api/passengers/:id` (PUT)
ุชู ุชุญุฏูุซ endpoint ุชุญุฏูุซ ุจูุงูุงุช ุงูุฑุงูุจ ูููุจู ููุญูุธ ุฌููุน ุงูุญููู:

**ูุจู:**
```javascript
// ูุงู ูุญูุธ ููุท: phone, name, email, password
```

**ุจุนุฏ:**
```javascript
// ูุญูุธ ุงูุขู: phone, name, email, password, car_type, car_plate, 
// balance, points, rating, status, avatar
```

#### ุชุญุฏูุซ `/api/passengers/:id` (GET)
ุชู ุชุญุฏูุซ endpoint ุฌูุจ ุจูุงูุงุช ุงูุฑุงูุจ ูููุฑุฌุน ุฌููุน ุงูุญููู:

**ูุจู:**
```sql
SELECT id, phone, name, email, created_at, updated_at 
FROM users WHERE id = $1 AND role = $2
```

**ุจุนุฏ:**
```sql
SELECT id, phone, name, email, role, car_type, car_plate, 
       balance, points, rating, status, avatar, created_at, updated_at 
FROM users WHERE id = $1 AND role = $2
```

#### ุชุญุฏูุซ `/api/passengers` (GET)
ุชู ุชุญุฏูุซ endpoint ุฌูุจ ูุงุฆูุฉ ุงูุฑูุงุจ ูููุฑุฌุน ุฌููุน ุงูุญููู ููู ุฑุงูุจ.

### 3. ุงูุญูุธ ุงูุชููุงุฆู
ูุธุงู ุงูุญูุธ ุงูุชููุงุฆู ูู `profile.html` ูุงู ูุนูู ุจุงููุนูุ ูููู ุงูุขู:
- โ ูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุฏูุงู ูู localStorage ููุท
- โ ูุญูุธ ุฌููุน ุงูุญููู ุงููุทููุจุฉ
- โ ููุญุฏุซ localStorage ุจุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐งช ุงูุงุฎุชุจุงุฑ

### ููู ุงูุงุฎุชุจุงุฑ: `test-passenger-update.js`
ุงุฎุชุจุงุฑ ุดุงูู ูุชุญูู ูู:
1. ุฌูุจ ุจูุงูุงุช ุฑุงูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุชุญุฏูุซ ุฌููุน ุงูุญููู (rating, points, balance, status, avatar)
3. ุงูุชุญูู ูู ุญูุธ ุงูุจูุงูุงุช
4. ุงูุชุฃูุฏ ูู ุซุจุงุช ุงูุจูุงูุงุช ุจุนุฏ ุฅุนุงุฏุฉ ุงูุฌูุจ

### ููู ุงูุงุฎุชุจุงุฑ ุงูุชูุงุนูู: `test-passenger-ui.html`
ูุงุฌูุฉ ููุจ ูุงุฎุชุจุงุฑ ุงููุธุงู ูุฏููุงู:
- ุฅุฏุฎุงู ุจูุงูุงุช ุงูุฑุงูุจ
- ุชุญุฏูุซ ุงูุจูุงูุงุช
- ุงูุชุญูู ุงูููุฑู ูู ุงูุญูุธ
- ููุงุฑูุฉ ุงูุจูุงูุงุช ุงูููุฏุฎูุฉ ูุน ุงููุญููุธุฉ

### ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ
```
๐งช ุงุฎุชุจุงุฑ ุชุญุฏูุซ ุจูุงูุงุช ุงูุฑุงูุจ

1๏ธโฃ ุฌูุจ ูุงุฆูุฉ ุงูุฑูุงุจ...
โ ุชู ุฌูุจ ุงูุฑุงูุจ: passenger3 (ID: 23)

2๏ธโฃ ุชุญุฏูุซ ุจูุงูุงุช ุงูุฑุงูุจ...
โ ุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ุจูุฌุงุญ
   - ุงูุชูููู: 4.80
   - ููุงุท ุฃููุงุฏุฑุง: 150
   - ุฑุตูุฏ ุงููุญูุธุฉ: 500.50 ุฑูุงู
   - ุงูุญุงูุฉ: ๐ ุนุถู ุฐูุจู

3๏ธโฃ ุงูุชุญูู ูู ุญูุธ ุงูุจูุงูุงุช...
โ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

4๏ธโฃ ุงูุชุญูู ูู ุงูุซุจุงุช...
   โ ุงูุชูููู ูุญููุธ
   โ ููุงุท ุฃููุงุฏุฑุง ูุญููุธุฉ
   โ ุฑุตูุฏ ุงููุญูุธุฉ ูุญููุธ
   โ ุงูุญุงูุฉ ูุญููุธุฉ
   โ ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ ูุญููุธุฉ

๐ ุงูุงุฎุชุจุงุฑ ูุฌุญ! ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ุจุดูู ุฏุงุฆู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุณุชุฎุฏู ุงูููุงุฆู
1. ุงูุชุญ ุตูุญุฉ ุงูููู ุงูุดุฎุตู (`profile.html`)
2. ุนุฏูู ุฃู ุจูุงูุงุช (ุงูุชููููุ ููุงุท ุฃููุงุฏุฑุงุ ุฑุตูุฏ ุงููุญูุธุฉุ ุฅูุฎ)
3. ุงูุจูุงูุงุช ุชูุญูุธ ุชููุงุฆูุงู ุจุนุฏ 1.5 ุซุงููุฉ ูู ุขุฎุฑ ุชุนุฏูู
4. ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ุฃู ุฅุบูุงู ุงููุชุตูุญุ ุฌููุน ุงูุชุนุฏููุงุช ูุญููุธุฉ
5. ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑูุ ุณุชุฌุฏ ุฌููุน ุงูุชุนุฏููุงุช ููุง ูู

### ูููุทูุฑ
```bash
# 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
DATABASE_URL="..." node migrate-users-table.js

# 2. ุชุดุบูู ุงูุฎุงุฏู
DATABASE_URL="..." node server.js

# 3. ุงุฎุชุจุงุฑ ุงููุธุงู
node test-passenger-update.js

# 4. ุงุฎุชุจุงุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู
# ุงูุชุญ: http://localhost:3000/test-passenger-ui.html
```

## ๐ ูุซุงู ุนูู API

### ุชุญุฏูุซ ุจูุงูุงุช ุฑุงูุจ
```bash
curl -X PUT http://localhost:3000/api/passengers/3 \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ุฑุงูุจ ุงุฎุชุจุงุฑ",
    "phone": "0553456789",
    "email": "test@ubar.sa",
    "rating": 4.9,
    "points": 500,
    "balance": 1000.50,
    "status": "๐ ุนุถู ุฐูุจู",
    "avatar": "https://example.com/avatar.jpg"
  }'
```

### ุงูุงุณุชุฌุงุจุฉ
```json
{
  "success": true,
  "data": {
    "id": 3,
    "name": "ุฑุงูุจ ุงุฎุชุจุงุฑ",
    "phone": "0553456789",
    "email": "test@ubar.sa",
    "role": "passenger",
    "rating": "4.90",
    "points": 500,
    "balance": "1000.50",
    "status": "๐ ุนุถู ุฐูุจู",
    "avatar": "https://example.com/avatar.jpg",
    "car_type": null,
    "car_plate": null,
    "created_at": "2026-02-05T...",
    "updated_at": "2026-02-05T..."
  }
}
```

## ๐ ุงูุฃูุงู

- โ ุฌููุน ุงูุจูุงูุงุช ุชูุญูุธ ูู ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL ุขููุฉ
- โ ุงุณุชุฎุฏุงู ูุนุงููุงุช SQL ููููุฃุฉ ูููุน SQL Injection
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูุจู ุงูุญูุธ
- โ ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู ูุจู ุงูุชุญุฏูุซ

## ๐ ููุงุญุธุงุช

1. **ุงูุญูุธ ุงูุชููุงุฆู:** ูุนูู ุจุนุฏ 1.5 ุซุงููุฉ ูู ุขุฎุฑ ุชุนุฏูู ูุชุฌูุจ ุงูุทูุจุงุช ุงููุชูุฑุฑุฉ
2. **ุงูุชูุงูู:** ูุนูู ูุน ุงูุณุงุฆููู ูุงูุฑูุงุจ ุนูู ุญุฏ ุณูุงุก
3. **localStorage:** ูุชู ุชุญุฏูุซู ุชููุงุฆูุงู ุจุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. **ุงูุฅุดุนุงุฑุงุช:** ุชุธูุฑ ุฑุณุงูุฉ "โ ุชู ุงูุญูุธ ุชููุงุฆูุงู" ุนูุฏ ูุฌุงุญ ุงูุญูุธ

## ๐ฏ ุงููููุงุช ุงูููุนุฏููุฉ

1. โ `server.js` - ุชุญุฏูุซ endpoints ุงูุฎุงุตุฉ ุจุงูุฑูุงุจ
2. โ `migrate-users-table.js` - ุฅุถุงูุฉ ุงูุญููู ุงููุทููุจุฉ
3. โ `test-passenger-update.js` - ุงุฎุชุจุงุฑ ุดุงูู (ุฌุฏูุฏ)
4. โ `test-passenger-ui.html` - ูุงุฌูุฉ ุงุฎุชุจุงุฑ (ุฌุฏูุฏ)
5. โ `PASSENGER_DATA_PERSISTENCE.md` - ูุฐู ุงููุซููุฉ (ุฌุฏูุฏ)

## โจ ุงูุฎูุงุตุฉ

ุชู ุญู ุงููุดููุฉ ุจูุฌุงุญ! ุงูุขู ุฌููุน ุจูุงูุงุช ุงูุฑุงูุจ ุชูุญูุธ ุจุดูู ุฏุงุฆู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุจูู ุญุชู ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ุฃู ุฅุบูุงู ุงููุชุตูุญ. ุงููุธุงู ูุฏุนู ุงูุญูุธ ุงูุชููุงุฆู ูุงูุญูุธ ุงููุฏููุ ููุนูู ุจููุงุกุฉ ุนุงููุฉ ูุน ุฅุดุนุงุฑุงุช ูุงุถุญุฉ ูููุณุชุฎุฏู.
