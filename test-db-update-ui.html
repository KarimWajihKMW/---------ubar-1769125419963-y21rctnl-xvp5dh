<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">๐งช ุงุฎุชุจุงุฑ ุงูุชุญุฏูุซ ุงููุจุงุดุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4">ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ</h2>
            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                <li>ุงุฎุชุฑ ุฑุงูุจ ูู ุงููุงุฆูุฉ</li>
                <li>ูู ุจุชุญุฏูุซ ุจูุงูุงุชู ูุจุงุดุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุนุจุฑ API)</li>
                <li>ุญููู ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</li>
                <li>ุชุญูู ูู ุธููุฑ ุงูุจูุงูุงุช ุงููุญุฏุซุฉ</li>
            </ol>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4">ุชุญุฏูุซ ุงูุจูุงูุงุช</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-gray-600 mb-2">ูุนุฑู ุงูุฑุงูุจ (ID)</label>
                    <input id="passengerId" type="number" class="w-full px-4 py-2 border rounded-lg" value="25">
                </div>
                
                <div>
                    <label class="block text-gray-600 mb-2">ุงูุชูููู (0-5)</label>
                    <input id="newRating" type="number" step="0.1" min="0" max="5" class="w-full px-4 py-2 border rounded-lg" value="3.7">
                </div>
                
                <div>
                    <label class="block text-gray-600 mb-2">ููุงุท ุฃููุงุฏุฑุง</label>
                    <input id="newPoints" type="number" class="w-full px-4 py-2 border rounded-lg" value="999">
                </div>
                
                <div>
                    <label class="block text-gray-600 mb-2">ุฑุตูุฏ ุงููุญูุธุฉ (ุฑูุงู)</label>
                    <input id="newBalance" type="number" step="0.01" class="w-full px-4 py-2 border rounded-lg" value="1500.25">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-gray-600 mb-2">ุงูุญุงูุฉ</label>
                    <select id="newStatus" class="w-full px-4 py-2 border rounded-lg">
                        <option value="ุนุถู ุฌุฏูุฏ">ุนุถู ุฌุฏูุฏ</option>
                        <option value="๐ ุนุถู ุฐูุจู">๐ ุนุถู ุฐูุจู</option>
                        <option value="๐ ุนุถู ุจูุงุชููู" selected>๐ ุนุถู ุจูุงุชููู</option>
                        <option value="โญ ุนุถู VIP">โญ ุนุถู VIP</option>
                    </select>
                </div>
            </div>
            
            <button onclick="updateInDatabase()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition">
                ุชุญุฏูุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
            </button>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4">ุงูุชุญูู ูู ุงูุจูุงูุงุช</h2>
            
            <div class="flex gap-4 mb-6">
                <button onclick="loadFromDatabase()" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 transition">
                    ุฌูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
                </button>
                
                <button onclick="simulateUILoad()" class="flex-1 bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                    ูุญุงูุงุฉ ุชุญููู ุงููุงุฌูุฉ
                </button>
            </div>

            <div id="dataDisplay" class="space-y-3">
                <div class="p-4 bg-gray-50 rounded">
                    <div class="font-bold text-gray-700 mb-2">ุงูุจูุงูุงุช ุงููุญููุฉ:</div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>ุงูุชูููู: <span id="displayRating" class="font-bold">-</span></div>
                        <div>ููุงุท ุฃููุงุฏุฑุง: <span id="displayPoints" class="font-bold">-</span></div>
                        <div>ุฑุตูุฏ ุงููุญูุธุฉ: <span id="displayBalance" class="font-bold">-</span></div>
                        <div>ุงูุญุงูุฉ: <span id="displayStatus" class="font-bold">-</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4">ุณุฌู ุงูุงุฎุชุจุงุฑ</h2>
            <div id="results" class="space-y-2 font-mono text-sm max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script src="api-service.js"></script>
    <script>
        let currentPassengerId = null;
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `p-2 rounded ${
                type === 'success' ? 'bg-green-100 text-green-800' :
                type === 'error' ? 'bg-red-100 text-red-800' :
                type === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                'bg-blue-100 text-blue-800'
            }`;
            div.textContent = `[${new Date().toLocaleTimeString('ar-EG')}] ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        async function updateInDatabase() {
            try {
                const passengerId = document.getElementById('passengerId').value;
                const newRating = parseFloat(document.getElementById('newRating').value);
                const newPoints = parseInt(document.getElementById('newPoints').value);
                const newBalance = parseFloat(document.getElementById('newBalance').value);
                const newStatus = document.getElementById('newStatus').value;
                
                log(`๐ ุชุญุฏูุซ ุจูุงูุงุช ุงูุฑุงูุจ ${passengerId} ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช...`, 'info');
                
                // First get current data
                const currentResponse = await ApiService.passengers.getById(passengerId);
                if (!currentResponse.success) {
                    throw new Error('ูุดู ุฌูุจ ุงูุจูุงูุงุช ุงูุญุงููุฉ');
                }
                
                const current = currentResponse.data;
                
                // Update with new values
                const updateResponse = await ApiService.passengers.update(passengerId, {
                    name: current.name,
                    phone: current.phone,
                    email: current.email,
                    rating: newRating,
                    points: newPoints,
                    balance: newBalance,
                    status: newStatus
                });
                
                if (!updateResponse.success) {
                    throw new Error('ูุดู ุงูุชุญุฏูุซ');
                }
                
                currentPassengerId = passengerId;
                
                log('โ ุชู ุงูุชุญุฏูุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ', 'success');
                log(`   ุงูุชูููู: ${updateResponse.data.rating}`, 'info');
                log(`   ููุงุท ุฃููุงุฏุฑุง: ${updateResponse.data.points}`, 'info');
                log(`   ุฑุตูุฏ ุงููุญูุธุฉ: ${updateResponse.data.balance} ุฑูุงู`, 'info');
                log(`   ุงูุญุงูุฉ: ${updateResponse.data.status}`, 'info');
                
                // Auto load to verify
                await loadFromDatabase();
                
            } catch (error) {
                log(`โ ุฎุทุฃ: ${error.message}`, 'error');
            }
        }
        
        async function loadFromDatabase() {
            try {
                const passengerId = currentPassengerId || document.getElementById('passengerId').value;
                
                log(`๐ฅ ุฌูุจ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุฑุงูุจ ${passengerId}...`, 'info');
                
                const response = await ApiService.passengers.getById(passengerId);
                
                if (!response.success) {
                    throw new Error('ูุดู ุฌูุจ ุงูุจูุงูุงุช');
                }
                
                const data = response.data;
                
                // Update display
                document.getElementById('displayRating').textContent = data.rating || '5.0';
                document.getElementById('displayPoints').textContent = data.points || '0';
                document.getElementById('displayBalance').textContent = `${data.balance || '0.00'} ุฑูุงู`;
                document.getElementById('displayStatus').textContent = data.status || 'ุนุถู ุฌุฏูุฏ';
                
                log('โ ุชู ุฌูุจ ุงูุจูุงูุงุช ุจูุฌุงุญ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช', 'success');
                log(`   ุงูุชูููู: ${data.rating}`, 'info');
                log(`   ููุงุท ุฃููุงุฏุฑุง: ${data.points}`, 'info');
                log(`   ุฑุตูุฏ ุงููุญูุธุฉ: ${data.balance} ุฑูุงู`, 'info');
                log(`   ุงูุญุงูุฉ: ${data.status}`, 'info');
                
            } catch (error) {
                log(`โ ุฎุทุฃ: ${error.message}`, 'error');
            }
        }
        
        async function simulateUILoad() {
            try {
                const passengerId = currentPassengerId || document.getElementById('passengerId').value;
                
                log(`๐ฅ๏ธ ูุญุงูุงุฉ ุชุญููู ุงููุงุฌูุฉ ููุฑุงูุจ ${passengerId}...`, 'info');
                log('โ๏ธ ูู ุงููุงุฌูุฉ ุงูุญููููุฉุ ุชุฃูุฏ ูู:','warning');
                log('   1. ุญุฐู localStorage ุฃู ูุชุญ ูุงูุฐุฉ ุฎููุฉ', 'warning');
                log('   2. ุชุณุฌูู ุงูุฏุฎูู ูุฑุงูุจ ุจููุณ ุงููุนุฑู', 'warning');
                log('   3. ูุชุญ ุตูุญุฉ ุงูููู ุงูุดุฎุตู', 'warning');
                log('   4. ุงูุชุญูู ูู ุธููุฑ ุงูุจูุงูุงุช ุงููุญุฏุซุฉ', 'warning');
                
                // Simulate the same logic in profile.html
                const response = await ApiService.passengers.getById(passengerId);
                
                if (!response.success) {
                    throw new Error('ูุดู ุฌูุจ ุงูุจูุงูุงุช');
                }
                
                const data = response.data;
                
                // Simulate applying overrides (should NOT override database values now)
                log('๐ ุชุทุจูู ููุทู ุงููุงุฌูุฉ...', 'info');
                log('   โน๏ธ ุงูุชุฌุงูุฒุงุช (overrides) ุชู ุชุนุทูููุง', 'info');
                log('   โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุง ุงูุฃููููุฉ', 'success');
                
                // Update display
                document.getElementById('displayRating').textContent = data.rating || '5.0';
                document.getElementById('displayPoints').textContent = data.points || '0';
                document.getElementById('displayBalance').textContent = `${data.balance || '0.00'} ุฑูุงู`;
                document.getElementById('displayStatus').textContent = data.status || 'ุนุถู ุฌุฏูุฏ';
                
                log('โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ (ููุง ุณุชุธูุฑ ูู ุงููุงุฌูุฉ):', 'success');
                log(`   ุงูุชูููู: ${data.rating}`, 'info');
                log(`   ููุงุท ุฃููุงุฏุฑุง: ${data.points}`, 'info');
                log(`   ุฑุตูุฏ ุงููุญูุธุฉ: ${data.balance} ุฑูุงู`, 'info');
                log(`   ุงูุญุงูุฉ: ${data.status}`, 'info');
                
            } catch (error) {
                log(`โ ุฎุทุฃ: ${error.message}`, 'error');
            }
        }
        
        // Auto load on page load
        window.addEventListener('load', () => {
            log('๐ฌ ุฌุงูุฒ ููุงุฎุชุจุงุฑ!', 'success');
            log('ุงุฎุชุฑ ูุนุฑู ุฑุงูุจ ููู ุจุชุญุฏูุซ ุงูุจูุงูุงุช', 'info');
        });
    </script>
</body>
</html>
