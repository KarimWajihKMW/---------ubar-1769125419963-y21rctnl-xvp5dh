# ุฑุจุท ูุธุงู ุงูุฑุญูุงุช ูุน ุทูุจุงุช ุงูุงูุชุธุงุฑ
## Trip & Pending Ride Requests Integration

## ุงููุดููุฉ ุงูุณุงุจูุฉ

ูุงูุช ุงูุทูุจุงุช ุงูุชู ูุนูููุง ุงูุฑุงูุจ ุนุจุฑ `POST /api/trips` ุชูุญูุธ ููุท ูู ุฌุฏูู `trips` ููุง ุชุธูุฑ ูู ุฌุฏูู `pending_ride_requests`ุ ููุง ูุนูู ุฃู ุงูุณุงุฆููู ูุง ูููููู ุฑุคูุฉ ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ.

## ุงูุญู ุงููุชูุงูู โ

ุชู ุฑุจุท ุงูุฌุฏูููู ุจุดูู ูุงูู ูุชุญููู ุงูุชูุงูู ุงูุชุงู:

### 1๏ธโฃ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ (ูู ุงูุฑุงูุจ)

ุนูุฏูุง ุงูุฑุงูุจ ูุนูู ุทูุจ ุนุจุฑ `POST /api/trips`:

```javascript
// ุชููุงุฆูุงู ูุชู:
1. ุญูุธ ุงูุทูุจ ูู ุฌุฏูู trips
2. ุฅูุดุงุก ุณุฌู ูุทุงุจู ูู pending_ride_requests ุจุญุงูุฉ 'waiting'
3. ุชุนููู ููุช ุงูุชูุงุก ุตูุงุญูุฉ (20 ุฏูููุฉ)
```

**ูุซุงู:**
```http
POST /api/trips
{
    "user_id": 1,
    "pickup_location": "ูุทุงุฑ ุงูููู ุฎุงูุฏ",
    "dropoff_location": "ุจุฑุฌ ุงูููููุฉ",
    "car_type": "economy",
    "cost": 78.50,
    ...
}
```

**ุงููุชูุฌุฉ:**
- โ ุณุฌู ูู `trips` ุจุญุงูุฉ `pending`
- โ ุณุฌู ูู `pending_ride_requests` ุจุญุงูุฉ `waiting`

### 2๏ธโฃ ุนุฑุถ ุงูุทูุจุงุช ููุณุงุฆู

ุงูุณุงุฆู ููููู ุงูุขู ุฑุคูุฉ ุฌููุน ุงูุทูุจุงุช ุงููุชุงุญุฉ:

```http
GET /api/drivers/:driver_id/pending-rides
```

ูุนุฑุถ:
- ุงูุทูุจุงุช ุงูุชู ููุน ุณูุงุฑุชูุง ูุทุงุจู ููุน ุณูุงุฑุฉ ุงูุณุงุฆู
- ุงูุทูุจุงุช ุงูุชู ูู ูุฑูุถูุง ูุฐุง ุงูุณุงุฆู ูู ูุจู
- ุงูุทูุจุงุช ุงูุชู ูู ุชูุชู ุตูุงุญูุชูุง

### 3๏ธโฃ ูุจูู ุงูุณุงุฆู ููุทูุจ

ุนูุฏูุง ุงูุณุงุฆู ููุจู ุงูุทูุจ ุนุจุฑ `POST /api/pending-rides/:request_id/accept`:

```javascript
// ุชููุงุฆูุงู ูุชู:
1. ุชุญุฏูุซ pending_ride_requests โ status = 'accepted'
2. ุงูุจุญุซ ุนู ุงูุฑุญูุฉ ุงููุทุงุจูุฉ ูู trips
3. ุชุญุฏูุซ trips โ driver_id, driver_name, status = 'assigned'
4. ุฃู ุฅูุดุงุก ุฑุญูุฉ ุฌุฏูุฏุฉ ุฅุฐุง ูู ุชูุฌุฏ
```

**ูุซุงู:**
```http
POST /api/pending-rides/REQ-123/accept
{
    "driver_id": 1
}
```

**ุงููุชูุฌุฉ:**
- โ `pending_ride_requests.status` = `'accepted'`
- โ `pending_ride_requests.assigned_driver_id` = `1`
- โ `trips.status` = `'assigned'`
- โ `trips.driver_id` = `1`

### 4๏ธโฃ ุชุญุฏูุซ ุญุงูุฉ ุงูุฑุญูุฉ

ุนูุฏูุง ูุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุฑุญูุฉ ุนุจุฑ `PATCH /api/trips/:id/status`:

```javascript
// ุชููุงุฆูุงู ูุชู ุชุญุฏูุซ pending_ride_requests:

- status = 'assigned' โ pending_ride_requests.status = 'accepted'
- status = 'cancelled' โ pending_ride_requests.status = 'cancelled'
- status = 'completed' โ pending_ride_requests.status = 'completed'
```

## ุชุฏูู ุงูุนูู ุงููุงูู ๐

```
1. ุงูุฑุงูุจ ูุทูุจ ุฑุญูุฉ
   โ
   POST /api/trips
   โ
   โ trips (status: pending)
   โ pending_ride_requests (status: waiting)

2. ุงูุณุงุฆู ูุฑู ุงูุทูุจุงุช ุงููุชุงุญุฉ
   โ
   GET /api/drivers/1/pending-rides
   โ
   ๐ ูุงุฆูุฉ ุงูุทูุจุงุช ุงููุชุงุญุฉ

3. ุงูุณุงุฆู ููุจู ุงูุทูุจ
   โ
   POST /api/pending-rides/REQ-123/accept
   โ
   โ pending_ride_requests (status: accepted, driver_id: 1)
   โ trips (status: assigned, driver_id: 1)

4. ุชุญุฏูุซ ุญุงูุฉ ุงูุฑุญูุฉ
   โ
   PATCH /api/trips/TR-123/status
   โ
   โ trips (status: ongoing/completed/cancelled)
   โ pending_ride_requests (status: ูุญุฏุซ ุชููุงุฆูุงู)
```

## ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ โจ

### ููุฑุงูุจ:
- โ ุทูุจุงุชู ุชุตู ููุณุงุฆููู ุชููุงุฆูุงู
- โ ููููู ุชุชุจุน ุญุงูุฉ ุงูุทูุจ ูู ุฎูุงู `pending_ride_requests`
- โ ูุนุฑู ูู ุณุงุฆู ุฑูุถ ุทูุจู

### ููุณุงุฆู:
- โ ูุฑู ุฌููุน ุงูุทูุจุงุช ุงููุชุงุญุฉ ูู ููุทูุชู
- โ ูุฑู ููุท ุงูุทูุจุงุช ุงูููุงุณุจุฉ ูููุน ุณูุงุฑุชู
- โ ูุง ูุฑู ุงูุทูุจุงุช ุงูุชู ุฑูุถูุง ุณุงุจูุงู
- โ ูุจูู ุงูุทูุจ ูุญุฏุซ ุงูุฑุญูุฉ ุชููุงุฆูุงู

### ูููุธุงู:
- โ ุชูุงูู ูุงูู ุจูู ุงูุฌุฏูููู
- โ ุชุฒุงูู ุชููุงุฆู ููุจูุงูุงุช
- โ ุณุฌู ูุงูู ูุญุงูุฉ ูู ุทูุจ
- โ ุฅููุงููุฉ ุชุญููู ูุนุฏูุงุช ุงููุจูู/ุงูุฑูุถ

## ุงูุงุฎุชุจุงุฑุงุช โ

ุชู ุฅูุดุงุก ููู ุงุฎุชุจุงุฑ ุดุงูู: `test-trip-pending-integration.js`

ุงุฎุชุจุงุฑุงุช ูุงุฌุญุฉ:
1. โ ุฅูุดุงุก ุฑุญูุฉ ูู ุงูุฑุงูุจ โ ูุธูุฑ ูู pending_ride_requests
2. โ ุงูุณุงุฆู ูุฑู ุงูุทูุจุงุช ุงููุชุงุญุฉ
3. โ ูุจูู ุงูุณุงุฆู โ ุชุญุฏูุซ trips
4. โ ุชุญุฏูุซ ุญุงูุฉ ุงูุฑุญูุฉ โ ุชุญุฏูุซ pending_ride_requests
5. โ ุฅูุบุงุก ุงูุฑุญูุฉ โ ุชุญุฏูุซ pending_ride_requests

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### ููุชุทุจูู:
ูุง ุญุงุฌุฉ ูุชุบููุฑ ุฃู ููุฏ ูู ุงูู frontendุ ุงูุชูุงูู ุชููุงุฆู!

### ููุงุฎุชุจุงุฑ:
```bash
# ุชุดุบูู ุงูุณูุฑูุฑ
DATABASE_URL="your_url" npm start

# ูู terminal ุขุฎุฑ
node test-trip-pending-integration.js
```

## ููุงุญุธุงุช ุชูููุฉ

### ูุนุงููุฑ ุงููุทุงุจูุฉ
ุนูุฏ ุงูุจุญุซ ุนู ุฑุญูุฉ ูุทุงุจูุฉ ูู `trips`ุ ูุณุชุฎุฏู:
- `user_id` ููุณ ุงูุฑุงูุจ
- `pickup_lat`, `pickup_lng` ููุณ ุงููููุน
- `status = 'pending'` ูู ูุชู ุชุนููู ุณุงุฆู ุจุนุฏ
- `created_at >= ุงูู 30 ุฏูููุฉ ุงูุฃุฎูุฑุฉ` ูุชุฌูุจ ุทูุจุงุช ูุฏููุฉ

### ุงูุชูุงุก ุงูุตูุงุญูุฉ
- ุทูุจุงุช `pending_ride_requests` ุชูุชูู ุจุนุฏ 20 ุฏูููุฉ
- ุทูุจุงุช `trips` ุชููุบู ุชููุงุฆูุงู ุจุนุฏ 20 ุฏูููุฉ (PENDING_TRIP_TTL_MINUTES)

### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฅุฐุง ูุดู ุงูุญูุธ ูู `pending_ride_requests`ุ ุงูุฑุญูุฉ ุชููุดุฃ ูู `trips` ูุงูุฎุทุฃ ููุณุฌู ููุท
- ุฅุฐุง ูุดู ุงูุชุญุฏูุซ ูู `trips` ุนูุฏ ุงููุจููุ ุงูุทูุจ ูุจูู ููุจูู ูููุณุฌู ุงูุฎุทุฃ

## ุงููููุงุช ุงููุนุฏูุฉ

### server.js
- ุฅุถุงูุฉ ููุฏ ูู `POST /api/trips` ูุฅูุดุงุก ุณุฌู ูู `pending_ride_requests`
- ุฅุถุงูุฉ ููุฏ ูู `PATCH /api/trips/:id/status` ูุชุญุฏูุซ `pending_ride_requests`
- ุฅุถุงูุฉ ููุฏ ูู `POST /api/pending-rides/:id/accept` ูุชุญุฏูุซ/ุฅูุดุงุก `trips`

### ุงููููุงุช ุงูุฌุฏูุฏุฉ
- `test-trip-pending-integration.js` - ุงุฎุชุจุงุฑ ุดุงูู ููุชูุงูู

## ุงูุฎูุงุตุฉ

ุงููุธุงู ุงูุขู ูุชูุงูู ุชูุงูุงู! ๐

**ูุจู:** ุงูุฑุงูุจ ูุทูุจ โ trips ููุท โ ุงูุณุงุฆู ูุง ูุฑู  
**ุจุนุฏ:** ุงูุฑุงูุจ ูุทูุจ โ trips + pending_ride_requests โ ุงูุณุงุฆู ูุฑู ูููุจู โ ุชุญุฏูุซ ุชููุงุฆู โ
